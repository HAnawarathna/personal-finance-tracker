<div class="categories-container">
  <!-- Header -->
  <div class="header">
    <h1>Categories</h1>
    <button class="btn btn-primary" (click)="openCreateModal()">
      <span class="icon">+</span> Add Category
    </button>
  </div>

  <!-- Error Message -->
  @if (error()) {
    <div class="alert alert-error">
      {{ error() }}
    </div>
  }

  <!-- Loading State -->
  @if (loading() && categories().length === 0) {
    <div class="loading">
      <div class="spinner"></div>
      <p>Loading categories...</p>
    </div>
  }

  <!-- Categories Grid -->
  @if (!loading() || categories().length > 0) {
    <div class="categories-grid">
      <!-- Income Categories -->
      <div class="category-section">
        <h2 class="section-title">
          <span class="icon">üíµ</span> Income Categories
          <span class="badge">{{ incomeCategories().length }}</span>
        </h2>
        
        @if (incomeCategories().length === 0) {
          <div class="empty-state">
            <p>No income categories yet</p>
            <button class="btn btn-secondary" (click)="openCreateModal()">Create First Income Category</button>
          </div>
        } @else {
          <div class="category-list">
            @for (category of incomeCategories(); track category.id) {
              <div class="category-card" [style.border-left-color]="category.color">
                <div class="category-info">
                  <span class="category-icon">{{ category.icon }}</span>
                  <div class="category-details">
                    <h3>{{ category.name }}</h3>
                    <span class="category-type">Income</span>
                  </div>
                </div>
                <div class="category-actions">
                  <button class="btn-icon" (click)="openEditModal(category)" title="Edit">
                    ‚úèÔ∏è
                  </button>
                  <button class="btn-icon btn-danger" (click)="deleteCategory(category)" title="Delete">
                    üóëÔ∏è
                  </button>
                </div>
              </div>
            }
          </div>
        }
      </div>

      <!-- Expense Categories -->
      <div class="category-section">
        <h2 class="section-title">
          <span class="icon">üí∏</span> Expense Categories
          <span class="badge">{{ expenseCategories().length }}</span>
        </h2>
        
        @if (expenseCategories().length === 0) {
          <div class="empty-state">
            <p>No expense categories yet</p>
            <button class="btn btn-secondary" (click)="openCreateModal()">Create First Expense Category</button>
          </div>
        } @else {
          <div class="category-list">
            @for (category of expenseCategories(); track category.id) {
              <div class="category-card" [style.border-left-color]="category.color">
                <div class="category-info">
                  <span class="category-icon">{{ category.icon }}</span>
                  <div class="category-details">
                    <h3>{{ category.name }}</h3>
                    <span class="category-type">Expense</span>
                  </div>
                </div>
                <div class="category-actions">
                  <button class="btn-icon" (click)="openEditModal(category)" title="Edit">
                    ‚úèÔ∏è
                  </button>
                  <button class="btn-icon btn-danger" (click)="deleteCategory(category)" title="Delete">
                    üóëÔ∏è
                  </button>
                </div>
              </div>
            }
          </div>
        }
      </div>
    </div>
  }

  <!-- Modal -->
  @if (showModal()) {
    <div class="modal-overlay" (click)="closeModal()">
      <div class="modal" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>{{ isEditing() ? 'Edit Category' : 'Create New Category' }}</h2>
          <button class="btn-close" (click)="closeModal()">&times;</button>
        </div>
        
        <form [formGroup]="categoryForm" (ngSubmit)="saveCategory()">
          <div class="modal-body">
            <!-- Name Input -->
            <div class="form-group">
              <label for="name">Category Name *</label>
              <input 
                id="name"
                type="text" 
                formControlName="name"
                placeholder="e.g., Groceries, Salary"
                class="form-control"
                [class.invalid]="categoryForm.get('name')?.invalid && categoryForm.get('name')?.touched"
              />
              @if (categoryForm.get('name')?.invalid && categoryForm.get('name')?.touched) {
                <span class="error-text">Please enter a valid name (min 2 characters)</span>
              }
            </div>

            <!-- Type Selection -->
            <div class="form-group">
              <label for="type">Type *</label>
              <select id="type" formControlName="type" class="form-control">
                <option value="income">Income</option>
                <option value="expense">Expense</option>
              </select>
            </div>

            <!-- Icon Selection -->
            <div class="form-group">
              <label>Icon</label>
              <div class="icon-grid">
                @for (icon of iconOptions; track icon) {
                  <button
                    type="button"
                    class="icon-option"
                    [class.selected]="categoryForm.get('icon')?.value === icon"
                    (click)="categoryForm.patchValue({ icon: icon })"
                  >
                    {{ icon }}
                  </button>
                }
              </div>
            </div>

            <!-- Color Selection -->
            <div class="form-group">
              <label>Color</label>
              <div class="color-grid">
                @for (color of colorOptions; track color) {
                  <button
                    type="button"
                    class="color-option"
                    [style.background-color]="color"
                    [class.selected]="categoryForm.get('color')?.value === color"
                    (click)="categoryForm.patchValue({ color: color })"
                    [title]="color"
                  ></button>
                }
              </div>
            </div>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="closeModal()">
              Cancel
            </button>
            <button 
              type="submit" 
              class="btn btn-primary"
              [disabled]="categoryForm.invalid || loading()"
            >
              {{ loading() ? 'Saving...' : (isEditing() ? 'Update' : 'Create') }}
            </button>
          </div>
        </form>
      </div>
    </div>
  }
</div>
