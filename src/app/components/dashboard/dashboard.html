<div class="dashboard-container">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <h2 class="logo">ğŸ’° Finance</h2>
    </div>

    <nav class="sidebar-nav">
      <a routerLink="/dashboard" class="nav-item active">
        <span class="icon">ğŸ“Š</span>
        <span>Dashboard</span>
      </a>
      <a routerLink="/transactions" class="nav-item">
        <span class="icon">ğŸ’³</span>
        <span>Transactions</span>
      </a>
      <a routerLink="/categories" class="nav-item">
        <span class="icon">ğŸ·ï¸</span>
        <span>Categories</span>
      </a>
      <a routerLink="/budget" class="nav-item">
        <span class="icon">ğŸ“‹</span>
        <span>Budget</span>
      </a>
    </nav>

    <div class="sidebar-footer">
      <div class="user-card">
        <img
          class="user-avatar"
          alt="User avatar"
          src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><defs><linearGradient id='g' x1='0' y1='0' x2='1' y2='1'><stop stop-color='%230ea5a4' offset='0'/><stop stop-color='%231f7a75' offset='1'/></linearGradient></defs><circle cx='32' cy='32' r='32' fill='url(%23g)'/><text x='32' y='38' font-size='20' text-anchor='middle' fill='white' font-family='Arial' font-weight='700'>SP</text></svg>"
        />
        <div class="user-details">
          <div class="user-name">S. Perera</div>
          <div class="user-email">s.perera@email.com</div>
        </div>
        <button class="user-action">View</button>
      </div>
    </div>
  </aside>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Top Navbar -->
    <header class="navbar">
      <div class="navbar-content">
        <h1 class="page-title">Dashboard</h1>
        <div class="navbar-right">
          <div class="clock" aria-live="polite">
            <div class="clock-time">{{ currentTime() }}</div>
            <div class="clock-date">{{ currentDate() }}</div>
          </div>
          <a routerLink="/register" class="btn-create" aria-label="Create account">
            <span class="btn-create-icon">+</span>
            <span class="btn-create-text">
              <span class="btn-create-title">Create account</span>
              <span class="btn-create-subtitle">Add a new profile</span>
            </span>
          </a>
          <button (click)="logout()" class="btn-logout">Logout</button>
        </div>
      </div>
    </header>

    <!-- Page Content -->
    <div class="content">
      @if (loading()) {
        <div class="loading">
          <div class="spinner"></div>
          <p>Loading dashboard...</p>
        </div>
      } @else {
        <!-- Financial Overview -->
        <div class="overview-grid">
          <div class="overview-card">
            <div class="card-icon income">ğŸ’µ</div>
            <div class="card-content">
              <h3>Total Income</h3>
              <p class="amount">${{ totalIncome() | number:'1.2-2' }}</p>
            </div>
          </div>

          <div class="overview-card">
            <div class="card-icon expense">ğŸ’¸</div>
            <div class="card-content">
              <h3>Total Expense</h3>
              <p class="amount">${{ totalExpense() | number:'1.2-2' }}</p>
            </div>
          </div>

          <div class="overview-card">
            <div class="card-icon balance" [class.negative]="balance() < 0">ğŸ’°</div>
            <div class="card-content">
              <h3>Balance</h3>
              <p class="amount" [class.negative]="balance() < 0">${{ balance() | number:'1.2-2' }}</p>
            </div>
          </div>
        </div>

        <!-- Recent Transactions & Budget Status -->
        <div class="content-grid">
          <!-- Recent Transactions -->
          <div class="card">
            <div class="card-header">
              <h2>Recent Transactions</h2>
              <a routerLink="/transactions" class="view-all">View All â†’</a>
            </div>
            
            @if (recentTransactions().length === 0) {
              <div class="empty-state">
                <p>No transactions yet</p>
              </div>
            } @else {
              <div class="transactions-list">
                @for (txn of recentTransactions(); track txn.id) {
                  <div class="transaction-item">
                    <div class="transaction-info">
                      <span class="transaction-icon">ğŸ’°</span>
                      <div>
                        <p class="transaction-category">
                          {{ getCategoryName(txn.categoryId) }}
                        </p>
                        <p class="transaction-date">{{ txn.date }}</p>
                      </div>
                    </div>
                    <span class="transaction-amount" [class]="txn.type">
                      {{ txn.type === 'income' ? '+' : '-' }}${{ txn.amount | number:'1.2-2' }}
                    </span>
                  </div>
                }
              </div>
            }
          </div>

          <!-- Budget Overview -->
          <div class="card">
            <div class="card-header">
              <h2>Budget Status</h2>
              <a routerLink="/budget" class="view-all">View All â†’</a>
            </div>

            @if (budgetStatus().length === 0) {
              <div class="empty-state">
                <p>No budgets set yet</p>
              </div>
            } @else {
              <div class="budget-list">
                @for (budget of budgetStatus(); track budget.id) {
                  <div class="budget-item">
                    <div class="budget-info">
                      <span class="budget-name">{{ budget.categoryName || 'Category' }}</span>
                      <span class="budget-amount">
                        ${{ (budget.spent || 0) | number:'1.2-2' }} / ${{ budget.amount | number:'1.2-2' }}
                      </span>
                    </div>
                    <div class="progress-bar">
                      <div 
                        class="progress-fill"
                        [class]="'progress-' + getProgressColor(budget.percentage)"
                        [style.width.%]="budget.percentage"
                      ></div>
                    </div>
                    <span class="budget-percentage">{{ budget.percentage | number:'1.0-0' }}%</span>
                  </div>
                }
              </div>
            }
          </div>
        </div>

        <!-- Category Breakdown -->
        @if (categoryBreakdown().length > 0) {
          <div class="card">
            <div class="card-header">
              <h2>Expense Breakdown by Category</h2>
            </div>
            <div class="category-breakdown">
              @for (category of categoryBreakdown(); track category.name) {
                <div class="category-item">
                  <div class="category-info">
                    <span class="category-name">{{ category.name }}</span>
                    <span class="category-amount">${{ category.amount | number:'1.2-2' }}</span>
                  </div>
                  <div class="category-percentage">
                    {{ ((category.amount / totalExpense()) * 100) | number:'1.0-0' }}%
                  </div>
                </div>
              }
            </div>
          </div>
        }
      }
    </div>
  </div>
</div>


