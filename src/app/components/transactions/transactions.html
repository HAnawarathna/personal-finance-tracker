<div class="transactions-container">
  <aside class="sidebar">
    <div class="sidebar-header">
      <h2 class="logo">üí∞ Finance</h2>
    </div>

    <nav class="sidebar-nav">
      <a routerLink="/dashboard" class="nav-item">
        <span class="icon">üìä</span>
        <span>Dashboard</span>
      </a>
      <a routerLink="/transactions" class="nav-item active">
        <span class="icon">üí≥</span>
        <span>Transactions</span>
      </a>
      <a routerLink="/categories" class="nav-item">
        <span class="icon">üè∑Ô∏è</span>
        <span>Categories</span>
      </a>
      <a routerLink="/budget" class="nav-item">
        <span class="icon">üìã</span>
        <span>Budget</span>
      </a>
    </nav>

    <div class="sidebar-footer">
      <div class="user-card">
        <img
          class="user-avatar"
          alt="User avatar"
          src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><defs><linearGradient id='g' x1='0' y1='0' x2='1' y2='1'><stop stop-color='%230ea5a4' offset='0'/><stop stop-color='%231f7a75' offset='1'/></linearGradient></defs><circle cx='32' cy='32' r='32' fill='url(%23g)'/><text x='32' y='38' font-size='20' text-anchor='middle' fill='white' font-family='Arial' font-weight='700'>SP</text></svg>"
        />
        <div class="user-details">
          <div class="user-name">S. Perera</div>
          <div class="user-email">s.perera@email.com</div>
        </div>
        <button class="user-action">View</button>
      </div>
      <button class="logout-btn" type="button" (click)="logout()">Log out</button>
    </div>
  </aside>

  <div class="main-content">
    <header class="navbar">
      <div class="navbar-content">
        <div>
          <h1 class="page-title">Transactions</h1>
          <p class="page-subtitle">Track every rupee with clean categorization and quick actions.</p>
        </div>
        <div class="navbar-actions">
          <button class="btn-secondary">Export</button>
          <button class="btn-primary" (click)="clearForm()">New Transaction</button>
        </div>
      </div>
    </header>

    @if (toastMessage()) {
      <div class="toast">{{ toastMessage() }}</div>
    }

    @if (error()) {
      <div class="alert alert-error">{{ error() }}</div>
    }

    <div class="content">
      <div class="content-grid">
        <div class="card form-card">
          <div class="card-header">
            <h2>Add Transaction</h2>
            <span class="helper-text">Add income or expense instantly</span>
          </div>

          <form [formGroup]="transactionForm" (ngSubmit)="onSubmit()" class="form-grid">
            <label class="form-field">
              <span>Title</span>
              <input type="text" placeholder="Salary payment" formControlName="title" />
              @if (transactionForm.get('title')?.touched && transactionForm.get('title')?.invalid) {
                <span class="error-text">Title is required</span>
              }
            </label>

            <label class="form-field">
              <span>Amount</span>
              <input type="number" placeholder="0.00" formControlName="amount" step="0.01" />
              @if (transactionForm.get('amount')?.touched && transactionForm.get('amount')?.invalid) {
                <span class="error-text">Valid amount is required</span>
              }
            </label>

            <label class="form-field">
              <span>Type</span>
              <select formControlName="type" (change)="onTypeChange()">
                <option value="income">Income</option>
                <option value="expense">Expense</option>
              </select>
            </label>

            <label class="form-field">
              <span>Category</span>
              <select formControlName="categoryId">
                <option value="">Select category</option>
                @for (category of currentCategories(); track category.id) {
                  <option [value]="category.id">{{ category.icon }} {{ category.name }}</option>
                }
              </select>
              @if (transactionForm.get('categoryId')?.touched && transactionForm.get('categoryId')?.invalid) {
                <span class="error-text">Category is required</span>
              }
            </label>

            <label class="form-field">
              <span>Date</span>
              <input type="date" formControlName="date" />
            </label>

            <div class="form-actions">
              <button type="button" class="btn-secondary" (click)="clearForm()">Clear</button>
              <button type="submit" class="btn-primary" [disabled]="loading()">
                {{ loading() ? 'Adding...' : 'Add Transaction' }}
              </button>
            </div>
          </form>
        </div>

        <div class="card table-card">
          <div class="card-header">
            <h2>All Transactions</h2>
            <div class="table-actions">
              <input 
                class="table-search" 
                placeholder="Search title or category"
                [value]="searchQuery()"
                (input)="searchQuery.set($any($event.target).value)"
              />
              <select 
                class="table-filter"
                [value]="typeFilter()"
                (change)="typeFilter.set($any($event.target).value)"
              >
                <option value="all">All Types</option>
                <option value="income">Income</option>
                <option value="expense">Expense</option>
              </select>
              <select 
                class="table-filter"
                [value]="categoryFilter()"
                (change)="categoryFilter.set($any($event.target).value)"
              >
                <option value="all">All Categories</option>
                @for (category of categories(); track category.id) {
                  <option [value]="category.id">{{ category.name }}</option>
                }
              </select>
            </div>
          </div>

          <div class="table-wrap">
            @if (loading()) {
              <div class="loading-state">Loading transactions...</div>
            } @else if (filteredTransactions().length === 0) {
              <div class="empty-state">
                <p>No transactions found.</p>
                <p class="empty-hint">Add your first transaction above to get started.</p>
              </div>
            } @else {
              <table class="transactions-table">
                <thead>
                  <tr>
                    <th>Title</th>
                    <th>Amount</th>
                    <th>Type</th>
                    <th>Category</th>
                    <th>Date</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  @for (transaction of filteredTransactions(); track transaction.id) {
                    <tr>
                      <td>
                        <div class="title-cell">
                          <span class="title-icon">{{ getCategoryIcon(transaction.categoryId) }}</span>
                          <div>
                            <div class="title-main">{{ transaction.title }}</div>
                          </div>
                        </div>
                      </td>
                      <td [class]="'amount-cell ' + transaction.type">
                        {{ formatAmount(transaction.amount, transaction.type) }}
                      </td>
                      <td>
                        <span [class]="'type-pill ' + transaction.type">
                          {{ transaction.type | titlecase }}
                        </span>
                      </td>
                      <td>{{ getCategoryName(transaction.categoryId) }}</td>
                      <td>{{ transaction.date }}</td>
                      <td>
                        <button 
                          class="btn-icon danger" 
                          (click)="deleteTransaction(transaction)"
                          type="button"
                        >
                          Delete
                        </button>
                      </td>
                    </tr>
                  }
                </tbody>
              </table>
            }
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
